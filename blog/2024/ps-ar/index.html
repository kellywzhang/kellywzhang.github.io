<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Posterior Sampling via Autoregressive Generation | Kelly W. Zhang </title> <meta name="author" content="Kelly W. Zhang"> <meta name="description" content="Bridging Generative Sequence Modeling and Online Decision-Making"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://kellywzhang.github.io/blog/2024/ps-ar/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js" integrity="sha256-rjmgmaB99riUNcdlrDtcAiwtLIojSxNyUFdl+Qh+rB4=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> <style type="text/css">.fake-img{background:#bbb;border:1px solid rgba(0,0,0,0.1);box-shadow:0 0 4px rgba(0,0,0,0.1);margin-bottom:12px}.fake-img p{font-family:monospace;color:white;text-align:left;margin:12px 0;text-align:center;font-size:16px}</style> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Posterior Sampling via Autoregressive Generation",
            "description": "Bridging Generative Sequence Modeling and Online Decision-Making",
            "published": "May 29, 2024",
            "authors": [
              
              {
                "author": "Kelly W. Zhang*",
                "authorURL": "https://kellywzhang.github.io/",
                "affiliations": [
                  {
                    "name": "Columbia University",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "Tiffany Cai*",
                "authorURL": "https://tc2718.github.io/",
                "affiliations": [
                  {
                    "name": "Columbia University",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "Hongseok Namkoong",
                "authorURL": "https://hsnamkoong.github.io/",
                "affiliations": [
                  {
                    "name": "Columbia University",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "Daniel Russo",
                "authorURL": "https://djrusso.github.io/",
                "affiliations": [
                  {
                    "name": "Columbia University",
                    "url": ""
                  }
                ]
              }
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Kelly</span> W. Zhang </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Posterior Sampling via Autoregressive Generation</h1> <p>Bridging Generative Sequence Modeling and Online Decision-Making</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#problem-setting">Problem Setting</a> </div> <div> <a href="#our-approach">Our Approach</a> </div> <div> <a href="#key-insights">Key Insights</a> </div> <div> <a href="#empirical-evaluation">Empirical Evaluation</a> </div> </nav> </d-contents> <p>Real-world decision-making often involves grappling with uncertainty. This challenge is particularly acute in areas like recommendation systems, where new items are continuously introduced, and personalized user experiences where new individual consistently enter the system. Traditional bandit algorithms struggle to handle the complex, unstructured data (e.g., text and images) that are common in modern applications. This work introduces a novel framework for learning bandit algorithms using autoregressive sequence models, offering a scalable and principled approach to Thompson sampling.</p> <h3 id="problem-setting">Problem Setting</h3> <p>Formally, we define meta-learning bandit problem where the bandit repeatedly encounters new tasks that require exploring to gather useful information. We illustrate our approach using a news article recommendation setting.</p> <p>Each day, new articles (actions) are released, and the system needs to recommend these to users while balancing exploration (trying new articles) and exploitation (showing the articles predicted to be the most popular based on the article headline text). Although article headlines provide a useful early indicator of article performance, models that solely rely on such features will eventually be outperformed by simple alternatives that learn from actual user feedback. The algorithm also has access to a large historical recommendation dataset on previously released articles from past days.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/psar/data-interactions4-480.webp 480w,/assets/img/psar/data-interactions4-800.webp 800w,/assets/img/psar/data-interactions4-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/psar/data-interactions4.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Our meta-bandit setting has two stages: (1) learning from a massive historical dataset and (2) online decision-making on a new task (recommendation problem with new items). </div> <h3 id="our-approach">Our Approach</h3> <p>The impetus of our approach is that <strong>unobserved outcome data</strong> is the source of the decision-maker’s uncertainty: feedback on an article has only been gathered from a subset of users, and there is residual uncertainty in how others users would respond.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/psar/multiple_imputation2-480.webp 480w,/assets/img/psar/multiple_imputation2-800.webp 800w,/assets/img/psar/multiple_imputation2-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/psar/multiple_imputation2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> We view uncertainty about unobserved outcomes as the source of uncertainty, avoiding explicit reference to latent parameters or variables. Calibrated generation (imputation) of missing outcomes enables uncertainty quantification and decision-making. </div> <p>Specifically, we propose a two-phase approach:</p> <p><strong>(1) Pretraining:</strong> Use the historical recommendation data to train an autoregressive sequence model $p_\theta$ that predicts successive user responses (e.g., clicks) to an article. This sequence model also takes in the article headline as input (via a pre-trained LLM that is fine-tuned).</p> <p><strong>(2) Online Decision-Making:</strong> At decision time, we use the pretrained model to autoregressively sample (impute) imaginary sequences of user feedback for each article. We then choose the article with the highest average imputed reward, representing a sample from the posterior distribution of the article’s true average reward.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/psar/posterior_sampling_implementation3-480.webp 480w,/assets/img/psar/posterior_sampling_implementation3-800.webp 800w,/assets/img/psar/posterior_sampling_implementation3-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/psar/posterior_sampling_implementation3.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Posterior Sampling via Autoregressive Generation (PS-AR). PS-AR uses autoregressive generation (imputation) of unobserved potential outcomes to (implicitly) reason about uncertainty and drive exploration of arms that could plausibly be optimal. After imputing all missing outcomes, it forms an imputed mean reward per action and selects the action with the highest imputed mean. </div> <h3 id="key-insights">Key Insights:</h3> <ul> <li> <strong>Implementation of Thompson Sampling:</strong> We show that this Posterior Sampling via Autoregressive Generation approach is a principled implementation of Thompson sampling (with a learned prior), a powerful algorithm for balancing exploration and exploitation.</li> <li> <strong>Regret Bound:</strong> We prove a novel regret bound that links the online performance of our algorithm to the prediction loss of the pretrained sequence model. This provides a strong theoretical foundation for our approach.</li> <li> <strong>Pretraining as Empirical Bayes:</strong>: We show that for particular choices for sequence model classes minimizing our pretraining loss is equivalent to maximizing the marginal likelihood, the criterion that is used in Empirical Bayes, a popular approach to fitting a prior distributions to observed data. We find in experiments that training on our sequence loss can recover the true Bayesian prior. Our pretraining procedure can be viewed as learning an approximate Bayesian model by gradient descent.</li> <li> <strong>Advantages of Autorgressive Viewpoint</strong>: Our framework leverages advances in autoregressive generative models (like transformers), allowing for scalability and integration with rich feature representations (e.g., article headlines).</li> </ul> <h3 id="empirical-evaluation">Empirical Evaluation:</h3> <p>We demonstrate our method on both synthetic and real-world news recommendation tasks. Our results show:</p> <ul> <li> <strong>Improved decision-making:</strong> Our approach outperforms traditional bandit algorithms by taking advantage of rich action features like article headlines.</li> <li> <strong>Uncertainty quantification:</strong> Our method allows us to effectively model uncertainty in the mean reward for each article. We use our pretrained sequence model to construct credible intervals for the mean rewards and find they have extremely well calibrated coverage.</li> </ul> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/psar/mind_eval-480.webp 480w,/assets/img/psar/mind_eval-800.webp 800w,/assets/img/psar/mind_eval-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/psar/mind_eval.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Left: In terms of cumulative regret, the PS-AR models that use sequence models $p_\theta$ that incorporate text features outperform all other algorithms. Right: We form credible intervals for the mean reward for each article/action by autoregressively sampling (imputing) many hypothetical sequences of future rewards given the article headline. </div> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/2024-05-24-psar.bib"></d-bibliography> </div> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>